---
title: 位操作
tags: 新建,模板,小书匠
grammar_cjkRuby: true
---


## XOR - 异或
异或的特点 

```
x ^ 0 = x
x ^ x = 0 // interesting and important!
```

异或运算可以进行复杂的操作，比如面试题：在1-100的范围内有99个数，且都不相同。求哪个数没有出现？就可以用异或解决。用1到100与这99个数进行异或。得到的结果就是没有出现的那个数

也可以进行数值交换 
```
temp =a ^b
a=a^temp
b=b^temp
```

不用辅助变量交换两个数
法1 可能会溢出
```
a=a+b;b=a-b;a=a-b
```
法2
```
a=a^b;b=a^b;a=a^b
```


## 移位操作 
记住一个法则就好，清零就是与操作 拿0和这位与 拿1与其他位与
置1就是或操作，拿1和这位或，拿0和其他位或

不过要记住的是这里位的下标是从右往左算，然后下标从0开始
> 将x最右边的n位清零  x & (~0 << n) 或者  x&~( (1<<n )-1)

其中~0表示的是所有位上都是1 也就是-1 ,~x表示每个位上取反

> 获取x的第n位值  (x>>(n-1))&1 
获取x的第n位的幂值  x & (1 << (n - 1))

比如12的第4位是1，而第四位的幂是8

>仅将第n位置为1  x | (1<<n)
>仅将第n位置为0   x &~(1<<n)

> 将x最高位至第n位(含)清零   x & ((1<<n)-1)    或者  x&~((~0<<n)-1)
> 将第n位(含)至第0位(含)清零  x &~( (1<<(n+1))-1)    或者 x&(~0<<(n+1))

> 仅更新第n位，写入值为v; v为1则更新为1，否则为0

这个题目的难点之处在于它即可能是与操作(清零),也可能是或操作置1，好在两个操作是可以级联的
mask = ~(1<<n) 
可以先与后或   x&mask) | v<<n，也可以先或后与 (x|(v<<n)) &mask     

## 求绝对值 
>如果n为正数，符号位为0，n>>31=0，原式=n^0-0=n-0=n。
如果n为负数，符号位为1，n>>31=-1，原始=(n^(-1))-(-1)=|n|。

```
int getABS1(int n){
	return (n ^ (n >> 31)) - (n >> 31);
}
```
##  求平均值
对于方法二，由与的特点，a&b是a和b均为1的位的平均值。a和b均为0的位的平均值也为0，可以忽略。由异或的特点，(a^b)>>1是a和b不同的为的平均值，相加即为a和b整体的平均值。
```
int getAverage1(int a, int b){
	return (a + b) >> 1;	//加法可能溢出
}
int getAverage2(int a, int b){
	return (a & b) + ((a ^ b) >> 1);
}
```


# 参考资料

[位运算应用技巧（1） » NoAlGo博客](http://noalgo.info/344.html)

[位运算应用技巧（2） » NoAlGo博客](http://noalgo.info/353.html)